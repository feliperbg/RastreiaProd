<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
<link rel="stylesheet" href="css/adminlte.css" /> 
 <!-- Header -->

  <nav class="app-header navbar navbar-expand bg-body">
    <div class="container-fluid">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-lte-toggle="sidebar" href="/painel" role="button">
            <i id ="iconeSideBar" class="bi bi-list"></i>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item dropdown user-menu">
          <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
            <img id="user-image" class="user-image rounded-circle shadow" alt="Usuário" />
            <span id= "nomeFuncionario" class="d-none d-md-inline">Usuário</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
            <li class="user-footer d-flex justify-content-between px-3 py-2">
              <button id="btnPerfil" class="btn btn-sm btn-outline-primary">Perfil</button>
              <button id="btnLogout" class="btn btn-sm btn-outline-danger">Sair</button>
            </li>
          </ul>
          
        </li>
      </ul>
    </div>
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div id="meuToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div id="toast-body" class="toast-body"></div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
        </div>
      </div>
    </div>
  </nav>
  <!-- Modal de Perfil -->
  <div class="modal fade" id="modalPerfil" tabindex="-1" aria-labelledby="modalPerfilLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalPerfilLabel">Meu Perfil</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body text-center">
          <img id="perfilImagem" src="" class="rounded-circle mb-3" width="80" height="80" alt="Foto de Perfil" />
          <p><strong>Nome:</strong> <span id="perfilNome"></span></p>
          <p><strong>Cargo:</strong> <span id="perfilCargo"></span></p>
          <p><strong>Credencial:</strong> <span id="perfilCredencial"></span></p>
        </div>
      </div>
    </div>
  </div>


  <script>
    // Exemplo de como definir o nome do funcionário no cabeçalho
    document.addEventListener('DOMContentLoaded', function() {
        const nomeFuncionario = document.getElementById("nomeFuncionario");
        const userDataJSON = localStorage.getItem("userData");
        const fotoFuncionario = document.getElementById("user-image");
        const btnLogout = document.getElementById("btnLogout");

        fotoFuncionario.src = localStorage.getItem("userImage");

        if (userDataJSON) {
        const userData = JSON.parse(userDataJSON);
        fotoFuncionario.src = userData.imagem;
        nomeFuncionario.textContent = userData.nome || "Funcionário";
        } else {
        nomeFuncionario.textContent = "Funcionário";
        }

    });

    btnLogout.addEventListener("click", function (event) {
      event.preventDefault();
      fazerLogout();
    });

    function fazerLogout() {
      fetch("/funcionario/logout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: localStorage.getItem("authToken") }),
      })
      .then(res => {
        if (!res.ok){
          throw new Error(exibirMensagem(`Erro na resposta do servidor: ${error.message}`, "erro"));
        }                                                                     
        return res.json();
      })
      .then(dados => {
        console.log("Dados do servidor:", dados);
        if (dados.status) {
          localStorage.removeItem('userData');
          localStorage.removeItem('authToken');
          localStorage.removeItem('userImage');
          localStorage.removeItem('rememberPassword');
          exibirMensagem("Logout bem-sucedido! Redirecionando...", "sucesso");
          window.location.href = '/';
        } else {
          exibirMensagem(dados.msg || "Credencial ou senha incorretos!", "erro");
        }
      })
      .catch(error => {
        exibirMensagem(`Erro ao fazer logout: ${error.message}`, "erro");
      });
    }
    document.getElementById('btnPerfil').addEventListener('click', () => {
    const dados = JSON.parse(localStorage.getItem('userData') || '{}');

    document.getElementById('perfilNome').textContent = dados.nome || '---';
    document.getElementById('perfilCargo').textContent = dados.role || '---';
    document.getElementById('perfilCredencial').textContent = dados.credencial || '---';
    document.getElementById('perfilImagem').src = dados.imagem || "imagens/funcionario/default.png";

    const modal = new bootstrap.Modal(document.getElementById('modalPerfil'));
    modal.show();
  });
  </script>