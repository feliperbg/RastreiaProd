<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
<link rel="stylesheet" href="css/adminlte.css" /> 
 <!-- Header -->
  <nav class="app-header navbar navbar-expand bg-body">
    <div class="container-fluid">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-lte-toggle="sidebar" href="painel" role="button">
            <i id ="iconeSideBar" class="bi bi-arrow-left"></i>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item dropdown user-menu">
          <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
            <img id="user-image" class="user-image rounded-circle shadow" alt="Usuário" />
            <span id= "nomeFuncionario" class="d-none d-md-inline">Usuário</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
            <li class="user-footer">
              <a href="#" class="btn btn-default btn-flat">Perfil</a>
              <a id = "btnLogout" class="btn btn-default btn-flat float-end">Sair</a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div id="meuToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div id="toast-body" class="toast-body"></div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
        </div>
      </div>
    </div>
  </nav>
  <script>
    // Exemplo de como definir o nome do funcionário no cabeçalho
    document.addEventListener('DOMContentLoaded', function() {
        const nomeFuncionario = document.getElementById("nomeFuncionario");
        const userDataJSON = localStorage.getItem("userData");
        const fotoFuncionario = document.getElementById("user-image");
        const btnLogout = document.getElementById("btnLogout");

        fotoFuncionario.src = localStorage.getItem("userImage");

        if (userDataJSON) {
        const userData = JSON.parse(userDataJSON);
        nomeFuncionario.textContent = userData.nome || "Funcionário";
        } else {
        nomeFuncionario.textContent = "Funcionário";
        }
        const icone = document.getElementById('iconeSideBar');
        const urlAtual = window.location.href;
        // Verifica se a URL contém "painel" e altera o ícone
        if (urlAtual.includes('painel')) {
            icone.classList.remove('bi', 'bi-arrow-left');
            icone.classList.add('bi', 'bi-list');
        }

    });

    btnLogout.addEventListener("click", function (event) {
      event.preventDefault();
      fazerLogout();
    });

    function fazerLogout() {
      fetch("/funcionario/logout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: localStorage.getItem("authToken") }),
      })
      .then(res => {
        if (!res.ok){
          throw new Error(exibirMensagem(`Erro na resposta do servidor: ${error.message}`, "erro"));
          
        }                                                                     
        return res.json();
      })
      .then(dados => {
        console.log("Dados do servidor:", dados);
        if (dados.status) {
          localStorage.removeItem('userData');
          localStorage.removeItem('authToken');
          localStorage.removeItem('userImage');
          exibirMensagem("Logout bem-sucedido! Redirecionando...", "sucesso");
          window.location.href = '/';
        } else {
          exibirMensagem(dados.msg || "Credencial ou senha incorretos!", "erro");
        }
      })
      .catch(error => {
        exibirMensagem(`Erro ao fazer logout: ${error.message}`, "erro");
      });
    }

  </script>